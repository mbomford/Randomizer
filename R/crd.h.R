
# This file is automatically generated, you probably don't want to edit this

CRDOptions <- if (requireNamespace('jmvcore')) R6::R6Class(
    "CRDOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            trt = NULL,
            reps = 4,
            properties = TRUE,
            degfree = TRUE,
            seed = 0,
            mapGraph = FALSE,
            legend = FALSE,
            col = 2,
            plotList = FALSE, ...) {

            super$initialize(
                package='Randomization',
                name='CRD',
                requiresData=TRUE,
                ...)

            private$..trt <- jmvcore::OptionVariables$new(
                "trt",
                trt,
                permitted=list(
                    "factor",
                    "id"))
            private$..reps <- jmvcore::OptionInteger$new(
                "reps",
                reps,
                default=4,
                min=0)
            private$..properties <- jmvcore::OptionBool$new(
                "properties",
                properties,
                default=TRUE)
            private$..degfree <- jmvcore::OptionBool$new(
                "degfree",
                degfree,
                default=TRUE)
            private$..seed <- jmvcore::OptionInteger$new(
                "seed",
                seed,
                default=0,
                min=0)
            private$..mapGraph <- jmvcore::OptionBool$new(
                "mapGraph",
                mapGraph,
                default=FALSE)
            private$..legend <- jmvcore::OptionBool$new(
                "legend",
                legend,
                default=FALSE)
            private$..col <- jmvcore::OptionInteger$new(
                "col",
                col,
                default=2,
                min=1)
            private$..plotList <- jmvcore::OptionBool$new(
                "plotList",
                plotList,
                default=FALSE)

            self$.addOption(private$..trt)
            self$.addOption(private$..reps)
            self$.addOption(private$..properties)
            self$.addOption(private$..degfree)
            self$.addOption(private$..seed)
            self$.addOption(private$..mapGraph)
            self$.addOption(private$..legend)
            self$.addOption(private$..col)
            self$.addOption(private$..plotList)
        }),
    active = list(
        trt = function() private$..trt$value,
        reps = function() private$..reps$value,
        properties = function() private$..properties$value,
        degfree = function() private$..degfree$value,
        seed = function() private$..seed$value,
        mapGraph = function() private$..mapGraph$value,
        legend = function() private$..legend$value,
        col = function() private$..col$value,
        plotList = function() private$..plotList$value),
    private = list(
        ..trt = NA,
        ..reps = NA,
        ..properties = NA,
        ..degfree = NA,
        ..seed = NA,
        ..mapGraph = NA,
        ..legend = NA,
        ..col = NA,
        ..plotList = NA)
)

CRDResults <- if (requireNamespace('jmvcore')) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        properties = function() private$.items[["properties"]],
        degfree = function() private$.items[["degfree"]],
        plot = function() private$.items[["plot"]],
        plots = function() private$.items[["plots"]],
        power = function() private$.items[["power"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Completely Randomized Design")
            self$add(jmvcore::Table$new(
                options=options,
                name="properties",
                title="Design Properties",
                rows=1,
                columns=list(
                    list(
                        `name`="Factors", 
                        `type`="integer"),
                    list(
                        `name`="Levels", 
                        `type`="integer"),
                    list(
                        `name`="Treatments", 
                        `type`="integer"),
                    list(
                        `name`="Replicates", 
                        `type`="integer"),
                    list(
                        `name`="Plots", 
                        `type`="integer"),
                    list(
                        `name`="Seed", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="degfree",
                title="Degrees of Freedom",
                visible=FALSE,
                rows=0,
                columns=list(
                    list(
                        `name`="Source", 
                        `type`="text"),
                    list(
                        `name`="df", 
                        `type`="integer"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Plot Map",
                width=600,
                height=500,
                renderFun=".plot",
                visible=FALSE))
            self$add(jmvcore::Table$new(
                options=options,
                name="plots",
                title="Plot List",
                visible=FALSE,
                rows=0,
                columns=list(
                    list(
                        `name`="Plot", 
                        `type`="integer"),
                    list(
                        `name`="Column", 
                        `type`="integer"),
                    list(
                        `name`="Row", 
                        `type`="integer"),
                    list(
                        `name`="Treatment", 
                        `type`="text"))))
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="power",
                title="Power Analysis",
                visible=FALSE))}))

CRDBase <- if (requireNamespace('jmvcore')) R6::R6Class(
    "CRDBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'Randomization',
                name = 'CRD',
                version = c(0,3,0),
                options = options,
                results = CRDResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Completely Randomized Design
#'
#' 
#' @param data .
#' @param trt .
#' @param reps .
#' @param properties .
#' @param degfree .
#' @param seed .
#' @param mapGraph .
#' @param legend .
#' @param col .
#' @param plotList .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$properties} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$degfree} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$plots} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$power} \tab \tab \tab \tab \tab a preformatted \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$properties$asDF}
#'
#' \code{as.data.frame(results$properties)}
#'
#' @export
CRD <- function(
    data,
    trt,
    reps = 4,
    properties = TRUE,
    degfree = TRUE,
    seed = 0,
    mapGraph = FALSE,
    legend = FALSE,
    col = 2,
    plotList = FALSE) {

    if ( ! requireNamespace('jmvcore'))
        stop('CRD requires jmvcore to be installed (restart may be required)')

    if ( ! missing(trt)) trt <- jmvcore::resolveQuo(jmvcore::enquo(trt))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(trt), trt, NULL))


    options <- CRDOptions$new(
        trt = trt,
        reps = reps,
        properties = properties,
        degfree = degfree,
        seed = seed,
        mapGraph = mapGraph,
        legend = legend,
        col = col,
        plotList = plotList)

    analysis <- CRDClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}
