
# This file is automatically generated, you probably don't want to edit this

LSDOptions <- if (requireNamespace('jmvcore')) R6::R6Class(
    "LSDOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            trt = NULL,
            arrange = "square",
            seed = 0,
            properties = TRUE,
            degfree = TRUE,
            mapGraph = FALSE,
            legend = FALSE,
            plotList = FALSE, ...) {

            super$initialize(
                package='Randomization',
                name='LSD',
                requiresData=TRUE,
                ...)

            private$..trt <- jmvcore::OptionVariables$new(
                "trt",
                trt,
                permitted=list(
                    "factor",
                    "id"))
            private$..arrange <- jmvcore::OptionList$new(
                "arrange",
                arrange,
                options=list(
                    "square",
                    "separate"),
                default="square")
            private$..seed <- jmvcore::OptionInteger$new(
                "seed",
                seed,
                default=0,
                min=0)
            private$..properties <- jmvcore::OptionBool$new(
                "properties",
                properties,
                default=TRUE)
            private$..degfree <- jmvcore::OptionBool$new(
                "degfree",
                degfree,
                default=TRUE)
            private$..mapGraph <- jmvcore::OptionBool$new(
                "mapGraph",
                mapGraph,
                default=FALSE)
            private$..legend <- jmvcore::OptionBool$new(
                "legend",
                legend,
                default=FALSE)
            private$..plotList <- jmvcore::OptionBool$new(
                "plotList",
                plotList,
                default=FALSE)

            self$.addOption(private$..trt)
            self$.addOption(private$..arrange)
            self$.addOption(private$..seed)
            self$.addOption(private$..properties)
            self$.addOption(private$..degfree)
            self$.addOption(private$..mapGraph)
            self$.addOption(private$..legend)
            self$.addOption(private$..plotList)
        }),
    active = list(
        trt = function() private$..trt$value,
        arrange = function() private$..arrange$value,
        seed = function() private$..seed$value,
        properties = function() private$..properties$value,
        degfree = function() private$..degfree$value,
        mapGraph = function() private$..mapGraph$value,
        legend = function() private$..legend$value,
        plotList = function() private$..plotList$value),
    private = list(
        ..trt = NA,
        ..arrange = NA,
        ..seed = NA,
        ..properties = NA,
        ..degfree = NA,
        ..mapGraph = NA,
        ..legend = NA,
        ..plotList = NA)
)

LSDResults <- if (requireNamespace('jmvcore')) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        properties = function() private$.items[["properties"]],
        degfree = function() private$.items[["degfree"]],
        plot = function() private$.items[["plot"]],
        plots = function() private$.items[["plots"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Latin Square Design")
            self$add(jmvcore::Table$new(
                options=options,
                name="properties",
                title="Design Properties",
                rows=1,
                columns=list(
                    list(
                        `name`="Factors", 
                        `type`="integer"),
                    list(
                        `name`="Levels", 
                        `type`="integer"),
                    list(
                        `name`="Treatments", 
                        `type`="integer"),
                    list(
                        `name`="Replicates", 
                        `type`="integer"),
                    list(
                        `name`="Plots", 
                        `type`="integer"),
                    list(
                        `name`="Seed", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="degfree",
                title="Degrees of Freedom",
                rows=0,
                columns=list(
                    list(
                        `name`="Source", 
                        `type`="text"),
                    list(
                        `name`="df", 
                        `type`="integer"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Plot Map",
                width=600,
                height=500,
                renderFun=".plot",
                visible=FALSE))
            self$add(jmvcore::Table$new(
                options=options,
                name="plots",
                title="Plot List",
                visible=FALSE,
                rows=0,
                columns=list(
                    list(
                        `name`="Plot", 
                        `type`="integer"),
                    list(
                        `name`="Column", 
                        `type`="integer"),
                    list(
                        `name`="Row", 
                        `type`="integer"),
                    list(
                        `name`="Treatment", 
                        `type`="text"))))}))

LSDBase <- if (requireNamespace('jmvcore')) R6::R6Class(
    "LSDBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'Randomization',
                name = 'LSD',
                version = c(0,3,0),
                options = options,
                results = LSDResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Latin Square Design
#'
#' 
#' @param data .
#' @param trt .
#' @param arrange .
#' @param seed .
#' @param properties .
#' @param degfree .
#' @param mapGraph .
#' @param legend .
#' @param plotList .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$properties} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$degfree} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$plots} \tab \tab \tab \tab \tab a table \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$properties$asDF}
#'
#' \code{as.data.frame(results$properties)}
#'
#' @export
LSD <- function(
    data,
    trt,
    arrange = "square",
    seed = 0,
    properties = TRUE,
    degfree = TRUE,
    mapGraph = FALSE,
    legend = FALSE,
    plotList = FALSE) {

    if ( ! requireNamespace('jmvcore'))
        stop('LSD requires jmvcore to be installed (restart may be required)')

    if ( ! missing(trt)) trt <- jmvcore::resolveQuo(jmvcore::enquo(trt))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(trt), trt, NULL))


    options <- LSDOptions$new(
        trt = trt,
        arrange = arrange,
        seed = seed,
        properties = properties,
        degfree = degfree,
        mapGraph = mapGraph,
        legend = legend,
        plotList = plotList)

    analysis <- LSDClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}
